<ngx-loading [show]="loading"></ngx-loading>
<main class="my-4">
  <div class="container">
    <div class="row">
      <div class="col-md-4 my-2">
        <div id="departments">
          <p class="my-3">
            <span>
              <h1 class="uniName"><button id="deparmentbutton" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapseDep">
                <i class="fas fa-sliders-h"></i>
              </button> <span>
                B√∂l√ºmler
              </span></h1>
            </span>
          <ul class="list-group" id="collapseDep">
            <li class="list-group-item deps" *ngFor="let item of departments">
              <a class="departmentLink" [routerLink]="['/universite-postlari',university.nameUrl,item.nameUrl]" >{{item.name}}</a>
            </li>
          </ul>
        </div>
        <hr>
      </div>
      <div class="col-md-8 my-2">
        <h1>
          <a class="uniName" [routerLink]="['/universite-postlari',university.nameUrl]" routerLinkActive="router-link-active" >{{university.name}}</a>
        </h1>
        <h3 class="depName text-center">
          {{selectedDep.name}}
        </h3>
        <hr>
        <div class="row">
          <div class="col">
            <form #form="ngForm" (ngSubmit)="CreatePost(title)">
              <div class="form-group">
                <input type="text" placeholder="Post ba≈ülƒ±ƒüƒ±nƒ± buraya giriniz.." maxlength="100" #title="ngModel" required [(ngModel)]="model.title" name="title" class="form-control" id="title" />
                <div class="text-danger m-1" *ngIf="title.invalid && title.touched">
                  <p *ngIf="title.errors.required">Post Ba≈ülƒ±ƒüƒ± alanƒ± girilmesi gereklidir</p>
                  <p *ngIf="title.errors.maxlength">Post Ba≈ülƒ±ƒüƒ± alanƒ±na en fazla 100 karakter girilebilir</p>
                </div>
              </div>
              <div class="form-group">
                <angular-editor  placeholder="Post i√ßeriƒüini buraya giriniz.." class="control" required #content="ngModel" [(ngModel)]="model.content" name="content"  [config]="editorConfig"></angular-editor>
              </div>
              <div class="form-group">
                <img [src]="item" *ngFor="let item of ImageUrls" class="img-fluid mx-1" style="width: 80px;"  alt="">
                <input type="file" multiple class="my-3 ml-3" accept="image/*" name="files" (change)="selectImage($event.target.files)">
              </div>
              <div class="form-group">
                <span class="d-flex justify-content-end">
                  <button [disabled]="form.invalid"  class="btn btn-primary">Payla≈ü</button>
                </span>
              </div>
            </form>
          </div>
        </div>
        <hr>
        <div class="row">
          <div class="col">
            <div class="alert alert-warning" *ngIf="uniposts.length == 0">
              Hen√ºz hi√ß post payla≈üƒ±lmadƒ±. ƒ∞lk payla≈üan sen ol...
            </div>
            <ul class="list-group ">
              <li class="list-group-item bg-light my-2" style="border: 1px solid rgba(0,0,0,.125);" *ngFor="let post of uniposts">
                <div class="media my-2">
                  <img [src]="post.imageUrl" width="64px" alt="ƒ∞mage" class="mr-2 postImage">
                  <div class="media-body">
                    <p>
                      <span style="word-wrap: break-word; " class="postTitle h4">{{post.title}}</span>
                      <span class="float-right">
                        <ng-template #popContent> <button (click)="sikayet(post.id)" class="btn btn-danger">≈ûikayet Et</button></ng-template>
                        <button style="border: none;" type="button" class="btn text-right" [ngbPopover]="popContent">
                          &#65049;
                        </button>
                      </span>
                    </p>
                    <p>
                      <span class="text-muted">
                        <a style="color: black;" class="texts mr-1" [routerLink]="['/profil',post.userId]" routerLinkActive="router-link-active" >{{post.userName}}</a>
                      </span>
                      <span>
                        <img [src]="post.rozetUrl" width="24px" alt="">
                      </span>
                      <span class="text-muted float-right texts">{{post.publishDate | date}}</span>
                    </p>
                    <span style="word-wrap: break-word;" class="postContent" [innerHTML]="post.content"></span>
                    <hr>
                    <p class="my-4">
                    <span>
                      <button *ngIf="!post.alreadyLiked" (click)="likePost(post,post.id)" class="texts bg-light" style=" border: none;" >
                        ü§ç
                      </button>
                      <button *ngIf="post.alreadyLiked" (click)="likePost(post,post.id)" class="bg-light texts text-danger" style=" border: none;">
                        &#10084;
                      </button>
                      <span class="ml-1 texts">{{post.likeCount}}</span>
                    </span>
                    <span>
                      <a [routerLink]="['/universite-postlari',university.nameUrl,'detay',post.id]" class="btn btn-primary texts float-right">Detaya Git</a>
                    </span>
                    </p>
                    <div class="badge badge-info" *ngIf="post.hasImage"><span style="font-size: 0.8rem;">Bu g√∂nderi resimli bir g√∂nderidir</span></div>
                    <div class="row ">
                      <div class="col">
                        <ul class="list-group " *ngFor="let comment of post.uniComments;let i = index">
                          <div *ngIf="comment.isVisible && i < post.shownComment">
                            <li class="list-group-item my-2" >
                              <div class="media">
                                <div>
                                  <img [src]="comment.imageUrl" width="64px" alt="ƒ∞mage" class="mr-2 commentImage">
                                  <p *ngIf="comment.isFavorite" class="text-center mt-2" style="font-size: 48px;color: green;">
                                    &#10003;
                                  </p>
                                </div>
                                <div class="media-body">
                                  <p>
                                    <span style="font-weight: bolder;">
                                      <a style="color: black;" class="texts mr-1" [routerLink]="['/profil',comment.userId]" routerLinkActive="router-link-active" >{{comment.userName}}</a>
                                    </span>
                                    <span>
                                      <img [src]="comment.rozetUrl" width="24px" alt="">
                                    </span>
                                    <span class="float-right">
                                      <ng-template #popContent> <button (click)="sikayetComment(comment.id)" class="btn btn-danger">≈ûikayet Et</button></ng-template>
                                      <button style="border: none;" type="button" class="btn text-right texts" [ngbPopover]="popContent">
                                        &#65049;
                                      </button>
                                    </span>
                                  </p>
                                  <span style="word-wrap: break-word;" class="texts">{{comment.commentContent}}</span>
                                  <hr>
                                  <p>
                                    <span style="font-size: 17px;">
                                      <button (click)="likeComment(comment,comment.id)" class="bg-light texts" style=" border: none;" *ngIf="!comment.alreadyLiked">
                                        ü§ç
                                      </button>
                                      <button (click)="likeComment(comment,comment.id)"class="bg-light texts" style=" border: none;" *ngIf="comment.alreadyLiked">
                                        &#10084;
                                      </button>
                                      <span class="ml-1 texts">{{comment.likeCount}}</span>
                                    </span>
                                    <span class="float-right texts">{{comment.commentDate | date}}</span>
                                  </p>
                                </div>
                              </div>
                            </li>
                          </div>
                        </ul>
                        <div *ngIf="post.uniComments.length > 3">
                          <span class="text-primary btn" (click)="ShowOthers(post)">{{post.showCount}} {{post.showMessage}}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <form #form2="ngForm"  (ngSubmit)="CreateComment(post, post.id, commentContent)">
                      <div class="form-row">
                        <div class="form-group col-sm-9 mt-1">
                          <input type="text" maxlength="200" placeholder="Yorum yap" #commentContent required name="commentContent" class="form-control" id="commentContent" />
                        </div>
                        <div class="form-group col-sm-3 mt-1">
                          <button  class="btn btn-primary btn-block">Payla≈ü</button>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </li>
            </ul>
          </div>
        </div>
        <hr>
        <div class="btn-toolbar d-flex justify-content-center" role="toolbar" aria-label="Toolbar with button groups">
          <div class="btn-group mr-2" role="group" aria-label="First group">
            <a (click)="refresPage(i+1)" [routerLink]="['/universite-postlari',university.nameUrl,selectedDep.nameUrl]"[queryParams]="{page: i+1}" routerLinkActive="router-link-active"  *ngFor="let item of pageInfo.totalPages;index as i" type="button" class="btn btn-secondary">{{i+1}}</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
